<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Leaderboard WoW Classic</title>
<style>
  body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: #121212;
    color: #eee;
    margin: 0;
    padding: 20px;
  }
  h1 {
    text-align: center;
    margin-bottom: 1rem;
  }
  table {
    width: 100%;
    max-width: 900px;
    margin: 0 auto;
    border-collapse: collapse;
    box-shadow: 0 0 15px rgba(0,0,0,0.7);
    background: #1e1e1e;
    border-radius: 8px;
    overflow: hidden;
  }
  th, td {
    padding: 12px 15px;
    text-align: center;
  }
  thead {
    background: #292929;
  }
  tbody tr {
    border-bottom: 1px solid #333;
    transition: background-color 0.3s ease;
  }
  tbody tr:hover {
    background-color: #444 !important;
  }
  tbody tr.inactive {
    color: #777;
  }
  tbody tr.inactive:hover {
    background-color: transparent !important;
  }
  th {
    user-select: none;
  }
  /* Niveau haut en vert, bas en gris */
  .level-high {
  color: #ffff00; /* jaune foncé vif */
  font-weight: 900; /* plus bold */
}

.level-low {
  color: #555; /* gris un peu plus clair que avant */
  font-weight: 600;
}

  /* Fantôme */
  .ghost-true {
  color: #8B0000; /* rouge foncé */
  font-weight: 700;
}
.ghost-false {
  color: #006400; /* vert foncé */
  font-weight: 700;
}
  /* Fonds par classe WoW Classic */
  .class-druid {
  background-color: rgba(255, 140, 0, 0.6);
  color: #000;
  border-radius: 8px;
  box-shadow: 0 1px 3px rgba(255, 140, 0, 0.4);
}

.class-priest {
  background-color: rgba(255, 255, 255, 0.8);
  color: #000;
  border-radius: 8px;
  box-shadow: 0 1px 3px rgba(255, 255, 255, 0.4);
}

.class-mage {
  background-color: rgba(135, 206, 250, 0.7);
  color: #000;
  border-radius: 8px;
  box-shadow: 0 1px 3px rgba(135, 206, 250, 0.4);
}

.class-warrior {
  background-color: rgba(192, 192, 192, 0.7);
  color: #000;
  border-radius: 8px;
  box-shadow: 0 1px 3px rgba(192, 192, 192, 0.4);
}

.class-rogue {
  background-color: rgba(255, 255, 0, 0.7);
  color: #000;
  border-radius: 8px;
  box-shadow: 0 1px 3px rgba(255, 255, 0, 0.4);
}

.class-hunter {
  background-color: rgba(34, 139, 34, 0.7);
  color: #000;
  border-radius: 8px;
  box-shadow: 0 1px 3px rgba(34, 139, 34, 0.4);
}

.class-warlock {
  background-color: rgba(148, 0, 211, 0.7);
  color: #000;
  border-radius: 8px;
  box-shadow: 0 1px 3px rgba(148, 0, 211, 0.4);
}

.class-shaman {
  background-color: rgba(30, 144, 255, 0.7);
  color: #000;
  border-radius: 8px;
  box-shadow: 0 1px 3px rgba(30, 144, 255, 0.4);
}


  @media (max-width: 600px) {
    table, thead, tbody, th, td, tr {
      display: block;
    }
    thead tr {
      display: none;
    }
    tbody tr {
      margin-bottom: 1rem;
      border-radius: 8px;
      background: #222;
      padding: 10px;
    }
    tbody tr td {
      text-align: right;
      padding-left: 50%;
      position: relative;
      border: none;
      border-bottom: 1px solid #444;
    }
    tbody tr td::before {
      content: attr(data-label);
      position: absolute;
      left: 15px;
      top: 12px;
      font-weight: 600;
      color: #aaa;
      text-transform: capitalize;
    }
    tbody tr td:last-child {
      border-bottom: 0;
    }
  }
</style>
</head>
<body>

<h1>Leaderboard WoW Classic</h1>

<table id="leaderboard">
  <thead>
    <tr>
      <th>Joueur</th>
      <th>Nom</th>
      <th>Niveau</th>
      <th>Classe</th>
      <th>Race</th>
      <th>Mort</th>
      <th>Niveau moyen équipement</th>
    </tr>
  </thead>
  <tbody>
    <!-- Data injected by JS -->
  </tbody>
</table>

<script>
  function classToClassName(className) {
    if (!className) return '';
    return 'class-' + className.toLowerCase();
  }

  async function loadLeaderboard() {
    try {
      const response = await fetch('resultats.json');
      if (!response.ok) throw new Error(`Erreur HTTP ${response.status}`);
      let players = await response.json();

      // Trie par niveau décroissant
      players.sort((a, b) => {
  // Si un joueur est vivant et niveau >= 10 et l'autre pas, il doit passer devant
  const aAliveHigh = (a.is_ghost === false || a.is_ghost === null) && a.level >= 10;
  const bAliveHigh = (b.is_ghost === false || b.is_ghost === null) && b.level >= 10;

  // Joueurs morts
  const aDead = a.is_ghost === true;
  const bDead = b.is_ghost === true;

  // Joueurs bas niveau
  const aLow = a.level < 10;
  const bLow = b.level < 10;

  // Ordre : aliveHigh > dead > lowLevel

  // 1. Si aAliveHigh et b pas => a avant b
  if (aAliveHigh && !bAliveHigh) return -1;
  if (!aAliveHigh && bAliveHigh) return 1;

  // 2. Si aDead et b pas => a après b (car dead vient après aliveHigh mais avant low)
  if (aDead && !bDead) {
    if (bLow) return -1;  // dead avant low
    return 1;             // dead après aliveHigh (déjà traité)
  }
  if (!aDead && bDead) {
    if (aLow) return 1;   // dead avant low
    return -1;
  }

  // 3. Si les deux sont dead, ou les deux aliveHigh, ou les deux low, trier par niveau décroissant
  return b.level - a.level;
});

      const tbody = document.querySelector('#leaderboard tbody');
      tbody.innerHTML = ''; // Clear previous content if any

      players.forEach(player => {
  const tr = document.createElement('tr');
  if (player.class) {
    tr.classList.add(classToClassName(player.class));
  }
  // Colonne Joueur (nouvelle)
  const tdPlayer = document.createElement('td');
  tdPlayer.textContent = player.player;  // premier nom
  tdPlayer.setAttribute('data-label', 'Joueur');
  tr.appendChild(tdPlayer);

  // Colonne Nom (nom du perso)
  const tdName = document.createElement('td');
  tdName.textContent = player.name;  // nom du personnage
  tdName.setAttribute('data-label', 'Nom');
  tr.appendChild(tdName);

  if (player.level < 10) {
    // Fusionner les 5 autres colonnes avec un message
    const tdMessage = document.createElement('td');
    tdMessage.colSpan = 5; // total colonnes restantes
    tdMessage.textContent = "Pas encore niveau 10";
    tdMessage.style.fontStyle = "italic";
    tdMessage.style.textAlign = "center";
    tdMessage.style.color = "#555";
    tr.appendChild(tdMessage);
  } else {
    // Niveau normal
    const tdLevel = document.createElement('td');
    tdLevel.textContent = player.level;
    tdLevel.setAttribute('data-label', 'Niveau');
    tdLevel.classList.add('level-high');
    tr.appendChild(tdLevel);

    const tdClass = document.createElement('td');
    tdClass.textContent = player.class ?? '-';
    tdClass.setAttribute('data-label', 'Classe');
    tr.appendChild(tdClass);

    const tdRace = document.createElement('td');
    tdRace.textContent = player.race ?? '-';
    tdRace.setAttribute('data-label', 'Race');
    tr.appendChild(tdRace);

    const tdGhost = document.createElement('td');
    if (player.is_ghost === true) {
      tdGhost.textContent = 'Oui';
      tdGhost.classList.add('ghost-true');
    } else if (player.is_ghost === false) {
      tdGhost.textContent = 'Non';
      tdGhost.classList.add('ghost-false');
    } else {
      tdGhost.textContent = '-';
    }
    tdGhost.setAttribute('data-label', 'Mort');
    tr.appendChild(tdGhost);

    const tdItemLevel = document.createElement('td');
    tdItemLevel.textContent = player.average_item_level ?? '-';
    tdItemLevel.setAttribute('data-label', 'Niveau moyen équipement');
    tr.appendChild(tdItemLevel);
  }

  tbody.appendChild(tr);
});


    } catch (error) {
      console.error("Erreur lors du chargement du leaderboard :", error);
      document.body.insertAdjacentHTML('beforeend', `<p style="color:red; text-align:center;">Erreur de chargement des données : ${error.message}</p>`);
    }
  }

  // Chargement au démarrage
  window.addEventListener('DOMContentLoaded', loadLeaderboard);
</script>

</body>
</html>
